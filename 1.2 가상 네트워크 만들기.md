# 1.2 가상 네트워크 만들기
가상 컴퓨터와 같이 Azure에서 Network의 사용이 필요한 리소스를 생성하려면 가상 네트워크를 지정해 주어야 합니다. 가상 네트워크와 사용자 데이터 센터간 VPN 또는 Express Route로 사설 네트워크를 연결시킬 수 있으며, 같은 지역의 두 개의 가상 네트워크를 피어링(peering)이라는 기능을 통해 연결할 수도 있습니다.

가상 네트워크를 설계할 때 주의할 점은 데이터 센터와의 추가 연결을 고려하여 IP대역을 지정하는 것이 좋으며, CIDR이라는 네트워크 표기법을 이용하여 사설 가상 네트워크 대역을 정의할 때 서비스 별로 서브넷(subnet)을 나눌 수 있도록 크게 잡아두는 것이 좋습니다.

이번 내용에서는 Azure 웹 콘솔로 가상 네트워크를 만들어 보는 작업과 가상 네트워크를 만든 후 Subnet을 제작하는 방법, 그리고 Azure cli 2.0을 통해 가상 네트워크와 Subnet을 만들어 보겠습니다.

## 웹 콘솔에서 가상 네트워크 만들기
1. [Azure 웹 콘솔](https://portal.azure.com)에 접속합니다.

2. 좌측 메뉴에서 **가상 네트워크**을 선택합니다.
    - 좌측 메뉴에 **가상 네트워크**가 없다면, 하단의 More Service를 선택 한 후 **virtual network**를 검색하여 선택합니다.

3. 블레이드에 **가상 네트워크**창이 뜨면 상단에 **+추가**버튼을 눌러서 **가상 네트워크**을 생성합니다.

4. **가상 네트워크 만들기** 블레이드가 뜨면 아래와 같이 설정을 입력합니다.
    - `이름` : 표시될 가상 네트워크 이름을 입력합니다.
    - `주소 공간` : 가상 네트워크의 CIDR값을 입력합니다. (예: 10.0.0.0/16)
    - `서브넷 이름` : 가상 네트워크를 만들 시 최초 생성시킬 서브넷 이름을 입력합니다.
    - `서브넷 주소 범위` : 서브넷의 CIDR값을 입력합니다. 이 값은 반드시 가상 네트워크의 CIDR 범위 안에 속해야 합니다. (예: 10.0.0.0/24)
    - `구독` : 가상 네트워크를 생성할 구독을 선택합니다.
    - `리소스 그룹` :
        - 새로 만들기 : 생성할 **리소스 그룹 이름**을 입력합니다.
        - 기존 그룹 사용 : 이미 생성한 **리소스 그룹**이 있다면 해당 리소스 그룹을 선택합니다.
    - `위치` : 가상 네트워크를 생성할 지역을 선택합니다. 
    > [!메모]
    >
    > 리소스 그룹 메뉴에서 새로 만들기를 할 시 리소스 그룹도 동일한 지역에 생성됩니다.

5. 하단의 **만들기**버튼을 클릭하여 **가상 네트워크**를 생성합니다.

## 웹 콘솔에서 가상 네트워크에 서브넷 추가하기
1. [Azure 웹 콘솔](https://portal.azure.com)에 접속합니다.

2. 좌측 메뉴에서 **가상 네트워크**을 선택합니다.
    - 좌측 메뉴에 **가상 네트워크**가 없다면, 하단의 More Service를 선택 한 후 **virtual network**를 검색하여 선택합니다.

3. 생성된 **가상 네트워크**를 클릭합니다.

4. **가상 네트워크** 블레이드의 좌측 메뉴에서 **서브넷**을 선택합니다.

5. **가상 네트워크**를 생성할 때 만들어진 가상 네트워크를 확인한 후 **+서브넷**을 클릭하여 새로운 서브넷을 만듭니다.

6. **서브넷 추가** 블레이드가 뜨면 아래와 같이 설정을 입력합니다.
    - `이름` : 표시될 서브넷 이름을 입력합니다.
    - `주소 범위(CIDR 블록)` : 서브넷의 CIDR값을 입력합니다. 이 값은 반드시 가상 네트워크의 CIDR 범위 안에 속해야 합니다. (예: 10.0.1.0/24)
    - `네트워크 보안 그룹` : 서브넷에는 **네트워크 보안 그룹**을 연결할 수 있습니다. 나중에 수정할 수 있으며, 여기서는 **없음**으로 선택 합니다.
    - `경로 테이블` : 서브넷에는 **사용자 지정 경로 테이블**을 설정할 수 있습니다. 나중에 수정할 수 있으며, 여기서는 **없음**으로 선택 합니다.

7. 하단의 **확인**버튼을 클릭하여 **서브넷**을 생성합니다.

## Azure cli 2.0으로 가상 네트워크 만들기
1. 각 운영체제에 맞는 cli 창을 실행 합니다.

2. 다음 명령을 사용하여 `Azure cli 2.0`을 인증 합니다.
    ```bash
    az login
    ```

3. 명령어 실행 후 웹 브라우저로 출력된 [URL](https://aka.ms/devicelogin)에 접속합니다.

4. **Devicr Login** 페이지가 뜨면 출력된 9자리의 코드를 복사하여 입력합니다.

5. **Microsoft Azure Cross-platform Command Line Interface** 라는 메세지와 함께 생성된 화면에서 **Continue**를 클릭합니다.

6. 로그인 창이 뜨면 Azure 계정으로 로그인 합니다.

7. **Microsoft Azure Cross-platform Command Line Interface** 이라는 메세지와 함께 인증이 완료되었다는 창이 뜨면 웹 브라우저를 닫고 다시 cli 창으로 돌아오면 인증이 완료된 것을 확인할 수 있습니다.
    > [!메모]
    >
    > JSON형식으로 출력된 값이 두 개 이상인 경우 로그인 한 계정에 연결된 구독(subscription)이 두 개 이상인 경우 입니다. 이 때 아래와 같은 명령어를 사용하여 특정 구독을 사용하겠다는 정의를 별도로 해 주어야 합니다.
    > ```bash
    > az account set --subscription "<Subscription ID>"
    > ```

8. 다음 명령을 사용하여 **가상 네트워크**를 생성합니다.
    - 예제1: **가상 네트워크** 기본 생성

    ```bash
    az network vnet create --name <표시 될 가상 네트워크 이름> -g <리소스 그룹 이름>
    ```
   >[!메모]
   >
   > `-l` 옵션이 없으면 **가상 네트워크**는 지정한 **리소스 그룹**이 있는 지역에 생성됩니다.
   > `--address-prefixes` 옵션이 없으면 `10.0.0.0/16`으로 **가상 네트워크**가 생성됩니다.
   > `--subnet-name` 옵션이 없으면 **서브넷**은 직접 생성해야 합니다.

   - 예제2: `CIDR`값을 설정한 **가상 네트워크** 생성

   ```bash
    az network vnet create --name <표시 될 가상 네트워크 이름> -g <리소스 그룹 이름> --address-prefixes <가상 네트워크의 CIDR>
   ```

   - 예제3: **서브넷**과 함께 **가상 네트워크** 생성
   ```bash
    az network vnet create --name <표시 될 가상 네트워크 이름> -g <리소스 그룹 이름> --address-prefixes <가상 네트워크의 CIDR> --subnet-name <표시 될 서브넷 이름> --subnet-prefix <서브넷의 CIDR>
   ```

9. 다음 명령을 사용하여 생성된 **가상 네트워크**를 확인합니다.
    - 예제1: **가상 네트워크** 기본 조회
    ```bash
    az network vnet list
    ```

    - 예제2: **리소스 그룹**을 기준으로 **가상 네트워크** 조회
    ```bash
    az network vnet list --g <리소스 그룹 이름>
    ```